#On Build/Server
# - Stop and set Docker Engine service to manual
# - reboot computer
# - open Docker Desktop as administrator

# - open Command Prompt running as admin run the following
#CREATE THE DOCKER IMAGE
docker build -t kioskapi2 C:\Users\Eric\Documents\KioskApi2\.

#SAVE IT TO A TAR FILE
docker save kioskapi2:latest -o C:\Users\Eric\Documents\KioskApi2\kiosk_api_image.tar

# - delete all the images and containers in Docker Desktop
# - Quit Docker Desktop
# - stop both docker services

#In Powershell running in admin mode:
Set-Service -Name "com.docker.service" -Status running -StartupType manual
Stop-Service -Name "com.docker.service"

# - install dockerd as service with:
"C:\Program Files\Docker\Docker\resources\dockerd" --register-service

# - if necessary set the Docker Engine service to automatic
# - Update C:\ProgramData\docker\config\daemon.json
#    - Remove: "hosts": [
#                  "npipe:////./pipe/docker_engine_windows"
#            ]

# - reboot computer

#  - open Power Shell as administrator
# - Run the following

#LOAD THE DOCKER IMAGE
docker load -i C:\Users\Eric\Documents\KioskApi2\kiosk_api_image.tar

#RUN IT
docker run --restart unless-stopped  -d -p 8080:8080 kioskapi2
